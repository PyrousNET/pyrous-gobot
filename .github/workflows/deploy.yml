name: Deploy

on:
  workflow_run:
    workflows: ["Go"]
    types: [completed]

jobs:
  restart-daemon:
    if: >
      github.event.workflow_run.conclusion == 'success' &&
      github.event.workflow_run.head_branch == 'main'
    runs-on: self-hosted
    concurrency: deploy-prod
    steps:
      - name: Restart gobot service
        run: |
          set -euo pipefail
          sudo systemctl restart gobot
          sudo systemctl status gobot --no-pager -l | head -n 30
